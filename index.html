<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecureLink - Emergency Response</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .app {
            max-width: 500px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            padding: 24px;
        }

        /* â”€â”€ Notification â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .notification {
            position: fixed; top: 24px; left: 50%;
            transform: translateX(-50%);
            z-index: 50; padding: 12px 24px; border-radius: 16px;
            font-weight: bold; font-size: 14px;
            box-shadow: 0 20px 25px -5px rgba(0,0,0,0.5);
            animation: slideDown 0.3s ease-out;
            display: none; text-align: center; max-width: 320px;
        }
        .notification.show    { display: block; }
        .notification.success { background-color: #16a34a; }
        .notification.error   { background-color: #dc2626; }
        .notification.warning { background-color: #ea580c; }
        .notification.info    { background-color: #2563eb; }
        @keyframes slideDown {
            from { opacity:0; transform: translateX(-50%) translateY(-20px); }
            to   { opacity:1; transform: translateX(-50%) translateY(0); }
        }

        /* â”€â”€ Pages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .page { display: none; flex: 1; flex-direction: column; }
        .page.active { display: flex; }

        /* â”€â”€ Landing â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .landing-content {
            flex: 1; display: flex; flex-direction: column;
            align-items: center; justify-content: center; text-align: center;
        }
        .logo-container {
            width: 96px; height: 96px;
            background: linear-gradient(135deg, #f97316 0%, #dc2626 100%);
            border-radius: 24px; display: flex; align-items: center; justify-content: center;
            margin-bottom: 24px;
            box-shadow: 0 20px 25px -5px rgba(249,115,22,0.3);
            animation: pulse-anim 3s ease-in-out infinite;
            font-size: 48px;
        }
        @keyframes pulse-anim { 0%,100%{transform:scale(1);} 50%{transform:scale(1.05);} }

        .app-title {
            font-size: 48px; font-weight: 900; letter-spacing: -2px; margin-bottom: 12px;
            background: linear-gradient(to right, #fff, #f97316);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
        }
        .app-subtitle { color: #94a3b8; margin-bottom: 16px; max-width: 280px; line-height: 1.5; }
        .app-tags { display: flex; gap: 8px; justify-content: center; margin-bottom: 48px; flex-wrap: wrap; }
        .tag { padding: 4px 10px; background-color: #1e293b; border-radius: 6px; font-size: 10px; color: #475569; }

        .button-group { width: 100%; display: flex; flex-direction: column; gap: 12px; margin-bottom: 32px; }
        .btn {
            padding: 16px; border: none; border-radius: 16px; font-weight: bold;
            cursor: pointer; transition: all 0.3s ease; font-size: 14px;
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #ea580c 0%, #dc2626 100%);
            color: white; box-shadow: 0 10px 20px rgba(234,88,12,0.3);
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 15px 30px rgba(234,88,12,0.4); }
        .btn-secondary { background-color: #1e293b; color: #cbd5e1; border: 1px solid #334155; }
        .btn-secondary:hover { background-color: #0f172a; }

        /* â”€â”€ Forms â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .form-container { flex: 1; display: flex; flex-direction: column; overflow-y: auto; }
        .form-header { display: flex; align-items: center; gap: 8px; margin-bottom: 24px; color: #cbd5e1; cursor: pointer; font-size: 14px; }
        .form-header:hover { color: #e2e8f0; }
        .form-title    { font-size: 28px; font-weight: 900; margin-bottom: 8px; }
        .form-subtitle { color: #94a3b8; font-size: 14px; margin-bottom: 32px; line-height: 1.5; }
        .form { display: flex; flex-direction: column; gap: 16px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }

        .input-wrapper {
            background-color: #1e293b; border: 1px solid #334155;
            border-radius: 12px; padding: 12px;
            display: flex; flex-direction: column; transition: border-color 0.3s;
        }
        .input-wrapper:focus-within { border-color: #f97316; }
        .input-label { font-size: 10px; color: #64748b; text-transform: uppercase; font-weight: bold; margin-bottom: 4px; }
        .input-wrapper input { background: transparent; border: none; outline: none; color: #fff; font-size: 14px; }
        .input-wrapper input::placeholder { color: #64748b; }

        .section-divider {
            padding: 12px 0 4px; font-size: 11px; font-weight: bold;
            color: #64748b; text-transform: uppercase; text-align: center;
            border-top: 1px solid #334155; margin: 4px 0;
        }

        /* â”€â”€ Dashboard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .dash-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .user-info { display: flex; align-items: center; gap: 12px; }
        .user-avatar {
            width: 48px; height: 48px;
            background: linear-gradient(135deg, #ea580c 0%, #dc2626 100%);
            border-radius: 12px; display: flex; align-items: center; justify-content: center;
            font-weight: 900; font-size: 18px; border: 2px solid #334155;
        }
        .user-name { font-size: 14px; font-weight: bold; }
        .user-sub  { font-size: 11px; color: #64748b; }

        .icon-btns { display: flex; gap: 8px; }
        .icon-btn {
            width: 40px; height: 40px; background-color: #1e293b;
            border: 1px solid #334155; border-radius: 12px; color: #cbd5e1;
            cursor: pointer; display: flex; align-items: center; justify-content: center;
            font-size: 16px; transition: all 0.3s;
        }
        .icon-btn:hover { border-color: #f97316; }
        .icon-btn.logout:hover { border-color: #dc2626; }

        /* GPS banners */
        .banner { padding: 12px 16px; border-radius: 12px; margin-bottom: 12px; font-size: 12px; display: none; }
        .banner.show { display: block; }
        .banner-error   { background-color: rgba(220,38,38,0.1); border: 1px solid rgba(220,38,38,0.3); color: #fecaca; }
        .banner-success { background-color: rgba(22,163,74,0.1);  border: 1px solid rgba(22,163,74,0.3);  color: #86efac; text-align:center; }
        .retry-btn { background-color: #dc2626; color: white; padding: 6px 12px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; font-size: 11px; margin-top: 8px; }

        /* Firebase status */
        .firebase-status {
            display: flex; align-items: center; gap: 8px;
            background-color: rgba(59,130,246,0.1); border: 1px solid rgba(59,130,246,0.3);
            border-radius: 10px; padding: 8px 12px; margin-bottom: 12px; font-size: 11px; color: #93c5fd;
        }
        .fb-dot { width: 8px; height: 8px; border-radius: 50%; background-color: #3b82f6; animation: pulse-anim 1.5s ease-in-out infinite; }
        .fb-dot.connected    { background-color: #22c55e; }
        .fb-dot.disconnected { background-color: #ef4444; animation: none; }

        /* â”€â”€ Panic button â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .panic-wrap { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .panic-btn {
            width: 260px; height: 260px; border-radius: 50%;
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            border: 18px solid #0f172a;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; position: relative;
            box-shadow: 0 0 60px rgba(220,38,38,0.5);
            transition: all 0.3s; font-weight: 900; color: white;
        }
        .panic-btn:not(:disabled):hover  { transform: scale(1.03); box-shadow: 0 0 80px rgba(220,38,38,0.7); }
        .panic-btn:not(:disabled):active { transform: scale(0.95); }
        .panic-btn:disabled { opacity: 0.4; cursor: not-allowed; }
        .panic-btn::before {
            content:''; position:absolute; inset:0;
            border: 4px solid #fca5a5; border-radius:50%;
            animation: ring 2s cubic-bezier(0,0,0.2,1) infinite; opacity:0.2;
        }
        @keyframes ring { 75%,100%{ transform:scale(2); opacity:0; } }
        .panic-icon { font-size: 56px; margin-bottom: 8px; z-index: 1; }
        .panic-label { font-size: 28px; letter-spacing: -1px; z-index: 1; }
        .panic-sub   { font-size: 10px; opacity: 0.7; margin-top: 6px; z-index: 1; }

        .sys-status { margin-top: 24px; text-align: center; font-size: 11px; color: #64748b; letter-spacing: 1px; text-transform: uppercase; }

        /* â”€â”€ Alert active â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        #alertSection { display: none; flex: 1; flex-direction: column; }
        .alert-head {
            background: linear-gradient(to right, rgba(220,38,38,0.2), rgba(249,115,22,0.2));
            border: 1px solid rgba(220,38,38,0.3);
            padding: 20px; border-radius: 20px; margin-bottom: 12px;
            display: flex; align-items: flex-start; justify-content: space-between;
        }
        .alert-title    { font-size: 22px; font-weight: 900; color: #ef4444; font-style: italic; margin-bottom: 6px; }
        .alert-veh      { font-size: 12px; color: #fca5a5; }
        .alert-loc      { font-size: 10px; color: #fecaca; margin-top: 6px; }
        .bcast-icon     { font-size: 28px; color: #dc2626; animation: pulse-anim 2s ease-in-out infinite; }
        .bcast-label    { font-size: 8px; color: #fca5a5; margin-top: 4px; text-align:center; }

        .dispatch-log {
            flex: 1; background-color: rgba(0,0,0,0.3); border: 1px solid #334155;
            border-radius: 20px; padding: 14px;
            font-family: 'Monaco', monospace; font-size: 11px; overflow-y: auto; margin-bottom: 12px;
        }
        .log-head  { color: #f97316; font-weight: bold; margin-bottom: 10px; }
        .log-entry { margin-bottom: 10px; border-left: 2px solid rgba(139,92,46,0.5); padding-left: 10px; color: #cbd5e1; line-height: 1.5; }

        .alert-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 4px; }
        .a-btn { padding: 14px; border-radius: 14px; font-weight: bold; cursor: pointer; font-size: 12px; display: flex; align-items: center; justify-content: center; gap: 6px; color: white; border: none; transition: all 0.3s; }
        .a-btn-share { background-color: #1e293b; border: 1px solid #475569; color: #cbd5e1; }
        .a-btn-share:hover { background-color: #334155; }
        .a-btn-safe  { background-color: #16a34a; }
        .a-btn-safe:hover  { background-color: #15803d; }

        /* â”€â”€ Info cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .info-cards { display: grid; grid-template-columns: repeat(3,1fr); gap: 10px; margin-top: 16px; }
        .info-card {
            background-color: #1e293b; padding: 14px; border-radius: 14px;
            border: 1px solid #334155; display: flex; flex-direction: column; align-items: center; text-align: center;
        }
        .card-icon  { font-size: 18px; margin-bottom: 6px; }
        .card-lbl   { font-size: 9px; color: #64748b; text-transform: uppercase; font-weight: bold; margin-bottom: 4px; }
        .card-val   { font-size: 12px; font-weight: bold; color: #e2e8f0; }
        .card-detail{ font-size: 10px; color: #64748b; }

        /* â”€â”€ Modals â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .modal { position: fixed; inset: 0; background-color: rgba(0,0,0,0.8); backdrop-filter: blur(4px); z-index: 40; display: none; flex-direction: column; align-items: flex-end; }
        .modal.show { display: flex; }
        .modal-box { background-color: #0f172a; width: 100%; border-top: 1px solid #334155; padding: 24px; max-height: 80vh; overflow-y: auto; border-radius: 24px 24px 0 0; animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from{transform:translateY(100%);} to{transform:translateY(0);} }
        .modal-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .modal-title{ font-size: 20px; font-weight: 900; }
        .close-btn  { background: none; border: none; color: #64748b; cursor: pointer; font-size: 24px; }
        .close-btn:hover { color: #fff; }

        .contact-item { background-color: #1e293b; border: 1px solid #334155; padding: 14px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .contact-name { font-weight: bold; color: white; font-size: 13px; }
        .contact-phone{ font-size: 12px; color: #cbd5e1; }
        .contact-rel  { font-size: 10px; color: #64748b; margin-top: 2px; }
        .del-btn { background: none; border: none; color: #ef4444; cursor: pointer; font-size: 16px; }

        .hist-item { background-color: #1e293b; border: 1px solid #334155; padding: 14px; border-radius: 12px; margin-bottom: 10px; }
        .hist-row  { display: flex; justify-content: space-between; margin-bottom: 6px; }
        .hist-num  { color: #ef4444; font-weight: bold; font-size: 12px; }
        .hist-time { font-size: 10px; color: #64748b; }
        .hist-detail { font-size: 12px; color: #cbd5e1; display: flex; flex-direction: column; gap: 3px; }

        .empty-state { text-align: center; padding: 32px; color: #64748b; }

        /* â”€â”€ Status bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .status-bar {
            margin-top: 12px; padding-top: 12px;
            display: flex; justify-content: space-between; align-items: center;
            font-size: 9px; color: #475569; font-family: monospace; letter-spacing: 1px;
            border-top: 1px solid rgba(52,65,85,0.5);
        }
        .gps-row  { display: flex; align-items: center; gap: 6px; }
        .gps-dot  { width: 6px; height: 6px; border-radius: 50%; animation: pulse-anim 1s ease-in-out infinite; }
        .gps-dot.on  { background-color: #22c55e; }
        .gps-dot.off { background-color: #64748b; animation: none; }

        audio { display: none; }

        .form-container::-webkit-scrollbar,
        .dispatch-log::-webkit-scrollbar,
        .modal-box::-webkit-scrollbar { width: 4px; }
        .form-container::-webkit-scrollbar-thumb,
        .dispatch-log::-webkit-scrollbar-thumb,
        .modal-box::-webkit-scrollbar-thumb { background: #334155; border-radius: 2px; }
    </style>
</head>
<body>
<div class="app">
    <div class="notification" id="notification"></div>

    <!-- â•â• LANDING â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page active" id="landingPage">
        <div class="landing-content">
            <div class="logo-container">ğŸ›¡ï¸</div>
            <h1 class="app-title">SECURE<span style="color:#f97316;">LINK</span></h1>
            <p class="app-subtitle">Elite armed response. Press PANIC â€” dispatchers respond in real time.</p>
            <div class="app-tags">
                <span class="tag">24/7 Response</span>
                <span class="tag">Live GPS</span>
                <span class="tag">Real-time Dispatch</span>
            </div>
            <div class="button-group">
                <button class="btn btn-primary" onclick="app.goTo('signUpPage')">Get Started â†’</button>
                <button class="btn btn-secondary" onclick="app.goTo('loginPage')">Log In</button>
            </div>
            <p style="font-size:10px;color:#475569;">Powered by Firebase â€¢ End-to-end secure</p>
        </div>
    </div>

    <!-- â•â• SIGN UP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="signUpPage">
        <div class="form-container">
            <div class="form-header" onclick="app.goTo('landingPage')">â† Back</div>
            <h2 class="form-title">Create Account</h2>
            <p class="form-subtitle">Your details are sent to dispatchers when you press PANIC.</p>
            <form class="form" onsubmit="app.handleSignUp(event)">
                <div class="form-row">
                    <div class="input-wrapper">
                        <label class="input-label">First Name</label>
                        <input type="text" placeholder="John" id="signupName" required>
                    </div>
                    <div class="input-wrapper">
                        <label class="input-label">Surname</label>
                        <input type="text" placeholder="Dube" id="signupSurname" required>
                    </div>
                </div>
                <div class="input-wrapper">
                    <label class="input-label">ğŸ“§ Email</label>
                    <input type="email" placeholder="john@example.com" id="signupEmail" required>
                </div>
                <div class="input-wrapper">
                    <label class="input-label">ğŸ”’ Password</label>
                    <input type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" id="signupPassword" minlength="6" required>
                </div>
                <div class="section-divider">Vehicle Details</div>
                <div class="input-wrapper">
                    <label class="input-label">ğŸš— Number Plate</label>
                    <input type="text" placeholder="GP 123 456" id="signupVehicleReg" required>
                </div>
                <div class="form-row">
                    <div class="input-wrapper">
                        <label class="input-label">Make / Model</label>
                        <input type="text" placeholder="Toyota Hilux" id="signupVehicleMake" required>
                    </div>
                    <div class="input-wrapper">
                        <label class="input-label">ğŸ¨ Color</label>
                        <input type="text" placeholder="White" id="signupVehicleColor" required>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary" style="margin-top:16px;">Complete Sign Up</button>
            </form>
        </div>
    </div>

    <!-- â•â• LOGIN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="loginPage">
        <div class="form-container">
            <div class="form-header" onclick="app.goTo('landingPage')">â† Back</div>
            <h2 class="form-title">Welcome Back</h2>
            <p class="form-subtitle">Log in to access your SecureLink dashboard.</p>
            <form class="form" onsubmit="app.handleLogin(event)" style="margin-top:40px;">
                <div class="input-wrapper">
                    <label class="input-label">ğŸ“§ Email</label>
                    <input type="email" placeholder="your@email.com" id="loginEmail" required>
                </div>
                <div class="input-wrapper">
                    <label class="input-label">ğŸ”’ Password</label>
                    <input type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" id="loginPassword" required>
                </div>
                <button type="submit" class="btn btn-primary" style="margin-top:24px;">Log In</button>
            </form>
        </div>
    </div>

    <!-- â•â• DASHBOARD â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="page" id="dashboardPage">
        <!-- Header -->
        <div class="dash-header">
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">US</div>
                <div>
                    <div class="user-name" id="userName">User</div>
                    <div class="user-sub"  id="userVehicle">â€”</div>
                </div>
            </div>
            <div class="icon-btns">
                <button class="icon-btn" onclick="app.showContacts()" title="Contacts">ğŸ‘¥</button>
                <button class="icon-btn" onclick="app.showHistory()" title="History">â°</button>
                <button class="icon-btn logout" onclick="app.logout()" title="Logout">ğŸšª</button>
            </div>
        </div>

        <!-- Firebase connection status -->
        <div class="firebase-status" id="fbStatus">
            <div class="fb-dot" id="fbDot"></div>
            <span id="fbStatusText">Connecting to SecureLink serversâ€¦</span>
        </div>

        <!-- GPS banners -->
        <div class="banner banner-error" id="gpsErrBanner">
            <div id="gpsErrMsg"></div>
            <button class="retry-btn" onclick="app.startGps()">Retry GPS</button>
        </div>
        <div class="banner banner-success" id="gpsOkBanner">
            âœ… GPS Active â€¢ Accuracy: <span id="gpsAcc">--</span>m
        </div>

        <!-- Panic button -->
        <div class="panic-wrap" id="panicWrap">
            <button class="panic-btn" id="panicBtn" onclick="app.handlePanic()" disabled>
                <div class="panic-icon">âš ï¸</div>
                <div class="panic-label">PANIC</div>
                <div class="panic-sub">TAP TO ALERT DISPATCH</div>
            </button>
            <div class="sys-status" id="sysStatus">ğŸŸ¡ Awaiting GPSâ€¦</div>
        </div>

        <!-- Alert active section -->
        <div id="alertSection">
            <div class="alert-head">
                <div>
                    <div class="alert-title">âš¡ Emergency Active</div>
                    <div class="alert-veh" id="alertVeh">â€”</div>
                    <div class="alert-loc" id="alertLoc">ğŸ“ â€”</div>
                </div>
                <div style="text-align:center;">
                    <div class="bcast-icon">ğŸ“¡</div>
                    <div class="bcast-label">LIVE</div>
                </div>
            </div>
            <div class="dispatch-log" id="dispatchLog">
                <div class="log-head">ğŸ“¡ DISPATCH LOG</div>
            </div>
            <div class="alert-actions">
                <button class="a-btn a-btn-share" onclick="app.shareLocation()">ğŸ“ Share</button>
                <button class="a-btn a-btn-safe"  onclick="app.cancelAlert()">I'M SAFE âœ“</button>
            </div>
        </div>

        <!-- Info cards -->
        <div class="info-cards" id="infoCards">
            <div class="info-card">
                <div class="card-icon">ğŸ”‹</div>
                <div class="card-lbl">Battery</div>
                <div class="card-val" id="battVal">--%</div>
            </div>
            <div class="info-card">
                <div class="card-icon">ğŸ“</div>
                <div class="card-lbl">GPS</div>
                <div class="card-val" id="gpsCardVal">â€”</div>
                <div class="card-detail" id="gpsCardDet">accuracy</div>
            </div>
            <div class="info-card">
                <div class="card-icon">ğŸ‘¥</div>
                <div class="card-lbl">Contacts</div>
                <div class="card-val" id="contactsVal">0</div>
            </div>
        </div>
    </div>

    <!-- â•â• CONTACTS MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="modal" id="contactsModal">
        <div class="modal-box">
            <div class="modal-head">
                <h3 class="modal-title">Emergency Contacts</h3>
                <button class="close-btn" onclick="app.hideContacts()">Ã—</button>
            </div>
            <form style="display:flex;flex-direction:column;gap:10px;margin-bottom:20px;" onsubmit="app.addContact(event)">
                <div class="input-wrapper">
                    <label class="input-label">Name</label>
                    <input type="text" placeholder="Mom / Partner" id="cName" required>
                </div>
                <div class="input-wrapper">
                    <label class="input-label">Phone</label>
                    <input type="tel" placeholder="+27 XX XXX XXXX" id="cPhone" required>
                </div>
                <div class="input-wrapper">
                    <label class="input-label">Relationship</label>
                    <input type="text" placeholder="Mother / Partner" id="cRel">
                </div>
                <button type="submit" class="btn btn-primary">ğŸ‘¤ Add Contact</button>
            </form>
            <div id="contactsList"></div>
        </div>
    </div>

    <!-- â•â• HISTORY MODAL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="modal" id="historyModal">
        <div class="modal-box">
            <div class="modal-head">
                <h3 class="modal-title">Alert History</h3>
                <button class="close-btn" onclick="app.hideHistory()">Ã—</button>
            </div>
            <div id="historyList"></div>
        </div>
    </div>

    <!-- Status bar -->
    <div class="status-bar">
        <div class="gps-row">
            <div class="gps-dot off" id="gpsDot"></div>
            <span id="gpsStatusTxt">GPS: STANDBY</span>
        </div>
        <div>SECURELINK SA</div>
        <div>V3.1 FIREBASE</div>
    </div>
</div>

<audio id="alertSnd" src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBT+P1fLIeDEGIXfH8N2RQgsc"></audio>

<script type="module">
import { initializeApp }                         from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getDatabase, ref, set, update, onValue }
                                                  from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

// â”€â”€ Firebase config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const firebaseConfig = {
    apiKey:            "AIzaSyAAHkSygnrYJF4axl2Mc-1wsE7erkI5tSc",
    authDomain:        "punic-button-4428e.firebaseapp.com",
    databaseURL:       "https://punic-button-4428e-default-rtdb.europe-west1.firebasedatabase.app",
    projectId:         "punic-button-4428e",
    storageBucket:     "punic-button-4428e.firebasestorage.app",
    messagingSenderId: "838411218299",
    appId:             "1:838411218299:web:402c4d5c0385946b3ca1de",
    measurementId:     "G-LZY15XKQL5"
};

const firebaseApp = initializeApp(firebaseConfig);
const db          = getDatabase(firebaseApp);

// â”€â”€ App state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const app = window.app = {
    user:          null,
    location:      null,
    watchId:       null,
    isAlerting:    false,
    activeAlertId: null,
    alertHistory:  [],
    batteryPct:    '--',

    // â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    init() {
        this.loadLocalUser();
        this.loadHistory();
        this.checkBattery();
        this.monitorConnection();
    },

    monitorConnection() {
        const connRef = ref(db, '.info/connected');
        onValue(connRef, snap => {
            const connected = snap.val();
            document.getElementById('fbDot').className        = 'fb-dot ' + (connected ? 'connected' : 'disconnected');
            document.getElementById('fbStatusText').textContent = connected
                ? 'ğŸŸ¢ Connected to SecureLink servers'
                : 'ğŸ”´ Offline â€” check internet connection';
        });
    },

    // â”€â”€ Local profile (no auth needed) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    loadLocalUser() {
        const raw = localStorage.getItem('sl-user');
        if (raw) { this.user = JSON.parse(raw); this.goTo('dashboardPage'); }
    },
    saveLocalUser() { localStorage.setItem('sl-user', JSON.stringify(this.user)); },

    loadHistory() {
        const raw = localStorage.getItem('sl-history');
        if (raw) this.alertHistory = JSON.parse(raw);
    },
    saveHistory() { localStorage.setItem('sl-history', JSON.stringify(this.alertHistory.slice(-20))); },

    // â”€â”€ Navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    goTo(page) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(page).classList.add('active');
        if (page === 'dashboardPage') { this.updateDashboardUI(); this.startGps(); }
    },

    // â”€â”€ Notifications â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    notify(msg, type = 'info') {
        const el = document.getElementById('notification');
        el.textContent = msg;
        el.className = `notification show ${type}`;
        setTimeout(() => el.classList.remove('show'), 3500);
    },

    // â”€â”€ Auth (local storage â€” no Firebase Auth needed) â”€â”€â”€â”€
    handleSignUp(e) {
        e.preventDefault();
        const name  = document.getElementById('signupName').value.trim();
        const sur   = document.getElementById('signupSurname').value.trim();
        const email = document.getElementById('signupEmail').value.trim();
        const reg   = document.getElementById('signupVehicleReg').value.trim();
        const make  = document.getElementById('signupVehicleMake').value.trim();
        const color = document.getElementById('signupVehicleColor').value.trim();
        if (!name || !sur || !email || !reg) { this.notify('âŒ Fill all required fields', 'error'); return; }
        this.user = {
            userId:       'u-' + Date.now(),
            name, surname: sur, email,
            vehicleReg:   reg.toUpperCase(), vehicleMake: make, vehicleColor: color,
            emergencyContacts: [],
            createdAt: new Date().toISOString()
        };
        this.saveLocalUser();
        this.notify('âœ… Account created!', 'success');
        this.goTo('dashboardPage');
    },

    handleLogin(e) {
        e.preventDefault();
        const email = document.getElementById('loginEmail').value.trim();
        const raw   = localStorage.getItem('sl-user');
        if (raw) {
            const profile = JSON.parse(raw);
            if (profile.email === email) {
                this.user = profile;
                this.notify('ğŸ‘‹ Welcome back!', 'success');
                this.goTo('dashboardPage');
                return;
            }
        }
        this.notify('âŒ No account found for that email', 'error');
    },

    logout() {
        if (this.activeAlertId) this.cancelAlert();
        if (this.watchId) navigator.geolocation.clearWatch(this.watchId);
        this.user = null; this.location = null; this.isAlerting = false; this.activeAlertId = null;
        this.goTo('landingPage');
    },

    updateDashboardUI() {
        if (!this.user) return;
        const initials = ((this.user.name?.[0] || 'U') + (this.user.surname?.[0] || '')).toUpperCase();
        document.getElementById('userAvatar').textContent  = initials;
        document.getElementById('userName').textContent    = this.user.name;
        document.getElementById('userVehicle').textContent = `${this.user.vehicleReg} â€¢ ${this.user.vehicleColor} ${this.user.vehicleMake}`;
        document.getElementById('contactsVal').textContent = (this.user.emergencyContacts || []).length;
    },

    // â”€â”€ GPS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    startGps() {
        if (!('geolocation' in navigator)) { this.setGpsError('Geolocation not supported'); return; }
        if (this.watchId) navigator.geolocation.clearWatch(this.watchId);
        this.watchId = navigator.geolocation.watchPosition(
            pos => {
                this.location = { lat: pos.coords.latitude, lng: pos.coords.longitude, accuracy: Math.round(pos.coords.accuracy) };
                this.clearGpsError();
                this.updateGpsUI();
                // Push live location if alert is active
                if (this.isAlerting && this.activeAlertId) {
                    update(ref(db, 'alerts/' + this.activeAlertId), {
                        location: this.location,
                        battery:  this.batteryPct,
                        lastSeen: new Date().toISOString()
                    });
                    document.getElementById('alertLoc').textContent = `ğŸ“ ${this.location.lat.toFixed(5)}, ${this.location.lng.toFixed(5)}`;
                }
            },
            err => {
                let msg = 'GPS error â€” enable location services.';
                if (err.code === 1) msg = 'âŒ Permission denied â€” allow location in settings.';
                if (err.code === 2) msg = 'ğŸ“ Position unavailable â€” check GPS signal.';
                if (err.code === 3) msg = 'â±ï¸ GPS timed out â€” retryingâ€¦';
                this.setGpsError(msg);
            },
            { enableHighAccuracy: true, maximumAge: 0, timeout: 15000 }
        );
    },

    setGpsError(msg) {
        document.getElementById('gpsErrMsg').textContent     = msg;
        document.getElementById('gpsErrBanner').classList.add('show');
        document.getElementById('gpsOkBanner').classList.remove('show');
        document.getElementById('gpsDot').className          = 'gps-dot off';
        document.getElementById('gpsStatusTxt').textContent  = 'GPS: ERROR';
        document.getElementById('sysStatus').textContent     = 'ğŸŸ¡ Awaiting GPSâ€¦';
        document.getElementById('panicBtn').disabled          = true;
        document.getElementById('gpsCardVal').textContent    = 'ERROR';
    },

    clearGpsError() { document.getElementById('gpsErrBanner').classList.remove('show'); },

    updateGpsUI() {
        document.getElementById('gpsOkBanner').classList.add('show');
        document.getElementById('gpsAcc').textContent       = this.location.accuracy;
        document.getElementById('gpsDot').className         = 'gps-dot on';
        document.getElementById('gpsStatusTxt').textContent = 'GPS: ACTIVE';
        document.getElementById('sysStatus').textContent    = 'ğŸŸ¢ System Ready â€” Tap PANIC to alert dispatch';
        document.getElementById('panicBtn').disabled         = false;
        document.getElementById('gpsCardVal').textContent   = 'ACTIVE';
        document.getElementById('gpsCardDet').textContent   = 'Â±' + this.location.accuracy + 'm';
    },

    // â”€â”€ Battery â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    checkBattery() {
        if (navigator.getBattery) {
            navigator.getBattery().then(bat => {
                const update = () => {
                    this.batteryPct = Math.round(bat.level * 100);
                    document.getElementById('battVal').textContent = this.batteryPct + '%';
                };
                update();
                bat.onlevelchange = update;
            }).catch(() => {});
        }
    },

    // â”€â”€ PANIC â†’ write to Firebase â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async handlePanic() {
        if (!this.location) { this.notify('â³ Waiting for GPSâ€¦', 'warning'); return; }

        this.isAlerting    = true;
        this.activeAlertId = 'alert-' + Date.now();

        const alertData = {
            alertId:      this.activeAlertId,
            status:       'active',
            userId:       this.user.userId,
            userName:     this.user.name,
            userSurname:  this.user.surname,
            vehicleReg:   this.user.vehicleReg,
            vehicleMake:  this.user.vehicleMake,
            vehicleColor: this.user.vehicleColor,
            location:     this.location,
            battery:      this.batteryPct,
            timestamp:    new Date().toISOString(),
            lastSeen:     new Date().toISOString(),
            resolvedAt:   null,
            resolvedBy:   null
        };

        try {
            // Write to Firebase â€” dispatch sees this instantly on any device
            await set(ref(db, 'alerts/' + this.activeAlertId), alertData);
        } catch(err) {
            this.notify('âš ï¸ Could not reach server â€” check internet', 'error');
            this.isAlerting = false;
            return;
        }

        // UI swap
        document.getElementById('panicWrap').style.display  = 'none';
        document.getElementById('alertSection').style.display = 'flex';
        document.getElementById('infoCards').style.display  = 'none';

        if ('vibrate' in navigator) navigator.vibrate([200,100,200,100,200]);
        document.getElementById('alertSnd').play().catch(() => {});

        document.getElementById('alertVeh').textContent =
            `${alertData.vehicleReg} â€¢ ${alertData.vehicleColor} ${alertData.vehicleMake}`;
        document.getElementById('alertLoc').textContent =
            `ğŸ“ ${this.location.lat.toFixed(5)}, ${this.location.lng.toFixed(5)}`;

        this.addLog('ğŸ“¡ PANIC SIGNAL SENT TO DISPATCH');
        setTimeout(() => this.addLog(`âœ… Verified: ${alertData.userName} ${alertData.userSurname}`), 500);
        setTimeout(() => this.addLog(`ğŸš— ${alertData.vehicleColor} ${alertData.vehicleMake} â€” ${alertData.vehicleReg}`), 1000);
        setTimeout(() => this.addLog(`ğŸ“ GPS: ${this.location.lat.toFixed(5)}, ${this.location.lng.toFixed(5)} (Â±${this.location.accuracy}m)`), 1500);
        setTimeout(() => this.addLog(`âš¡ Dispatchers notified â€” help is on the way`), 2200);

        // Save to local history
        this.alertHistory.push({
            alertId:   this.activeAlertId,
            timestamp: alertData.timestamp,
            location:  this.location,
            vehicle:   `${alertData.vehicleReg} â€” ${alertData.vehicleMake}`
        });
        this.saveHistory();
    },

    addLog(msg) {
        const log   = document.getElementById('dispatchLog');
        const entry = document.createElement('div');
        entry.className   = 'log-entry';
        entry.textContent = msg;
        log.appendChild(entry);
        log.scrollTop = log.scrollHeight;
    },

    // â”€â”€ Cancel alert â†’ update Firebase â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async cancelAlert() {
        if (this.activeAlertId) {
            try {
                await update(ref(db, 'alerts/' + this.activeAlertId), {
                    status:     'resolved',
                    resolvedAt: new Date().toISOString(),
                    resolvedBy: 'User (self â€” I\'m safe)'
                });
            } catch(e) { console.warn('Could not update Firebase on cancel:', e); }
        }
        this.isAlerting    = false;
        this.activeAlertId = null;

        document.getElementById('panicWrap').style.display    = 'flex';
        document.getElementById('alertSection').style.display = 'none';
        document.getElementById('infoCards').style.display    = 'grid';
        document.getElementById('dispatchLog').innerHTML      = '<div class="log-head">ğŸ“¡ DISPATCH LOG</div>';
        this.notify('âœ… Alert cancelled â€” Stay safe!', 'success');
    },

    // â”€â”€ Share â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    shareLocation() {
        if (!this.location) { this.notify('âŒ GPS not available', 'error'); return; }
        const u    = this.user;
        const text = `ğŸš¨ SecureLink Emergency\nUser: ${u.name} ${u.surname}\nVehicle: ${u.vehicleColor} ${u.vehicleMake} (${u.vehicleReg})\nLocation: https://maps.google.com?q=${this.location.lat},${this.location.lng}\nTime: ${new Date().toLocaleString()}`;
        if (navigator.share) {
            navigator.share({ title: 'SecureLink Emergency', text }).catch(() => {});
        } else {
            navigator.clipboard?.writeText(text);
            this.notify('ğŸ“‹ Location copied to clipboard', 'success');
        }
    },

    // â”€â”€ Contacts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    showContacts() { document.getElementById('contactsModal').classList.add('show'); this.renderContacts(); },
    hideContacts() { document.getElementById('contactsModal').classList.remove('show'); },

    renderContacts() {
        const list = document.getElementById('contactsList');
        const arr  = this.user?.emergencyContacts || [];
        list.innerHTML = arr.length === 0
            ? '<div class="empty-state">No contacts yet</div>'
            : arr.map((c, i) => `
                <div class="contact-item">
                    <div>
                        <div class="contact-name">${c.name}</div>
                        <div class="contact-phone">${c.phone}</div>
                        ${c.rel ? `<div class="contact-rel">${c.rel}</div>` : ''}
                    </div>
                    <button class="del-btn" onclick="app.removeContact(${i})">ğŸ—‘ï¸</button>
                </div>`).join('');
    },

    addContact(e) {
        e.preventDefault();
        const name  = document.getElementById('cName').value.trim();
        const phone = document.getElementById('cPhone').value.trim();
        const rel   = document.getElementById('cRel').value.trim();
        if (!name || !phone) { this.notify('âŒ Name and phone required', 'error'); return; }
        if (!this.user.emergencyContacts) this.user.emergencyContacts = [];
        this.user.emergencyContacts.push({ name, phone, rel });
        this.saveLocalUser();
        document.getElementById('cName').value = document.getElementById('cPhone').value = document.getElementById('cRel').value = '';
        document.getElementById('contactsVal').textContent = this.user.emergencyContacts.length;
        this.renderContacts();
        this.notify('âœ… Contact added', 'success');
    },

    removeContact(i) {
        this.user.emergencyContacts.splice(i, 1);
        this.saveLocalUser();
        document.getElementById('contactsVal').textContent = this.user.emergencyContacts.length;
        this.renderContacts();
    },

    // â”€â”€ History â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    showHistory() { document.getElementById('historyModal').classList.add('show'); this.renderHistory(); },
    hideHistory() { document.getElementById('historyModal').classList.remove('show'); },

    renderHistory() {
        const list = document.getElementById('historyList');
        if (!this.alertHistory.length) { list.innerHTML = '<div class="empty-state">No alerts yet</div>'; return; }
        list.innerHTML = [...this.alertHistory].reverse().map((a, i) => `
            <div class="hist-item">
                <div class="hist-row">
                    <span class="hist-num">Alert #${this.alertHistory.length - i}</span>
                    <span class="hist-time">${new Date(a.timestamp).toLocaleString()}</span>
                </div>
                <div class="hist-detail">
                    <div>ğŸ“ ${a.location?.lat?.toFixed(4) ?? '--'}, ${a.location?.lng?.toFixed(4) ?? '--'}</div>
                    <div>ğŸš— ${a.vehicle}</div>
                </div>
            </div>`).join('');
    }
};

app.init();
</script>
</body>
</html>
